
  <%= javascript_include_tag "jquery" %>
  <%= javascript_include_tag "bootstrap" %>
  <%= stylesheet_link_tag "bootstrap.min" %>
  <%= stylesheet_link_tag "extras/footer" %>
  <%= javascript_include_tag "sw.min" %>

<style type="text/css">
	
	#barcode-txt {
  border-color: black;
  border-style: solid;
  border-width: 0 0 1px;
  font-size: 30px;
  margin: 3% 4%;
  width: 60%
}	

</style>
<div style=" height: 97%; background: -moz-linear-gradient(right,#d3cce3,#e9e4f0 );" class="container-fluid"  >

	
	<div class="row">
		<div class="col-sm-4" style="height: 32%; margin-top: 1%; margin-left: 2%;
			 background: -moz-linear-gradient(right,rgba(62, 69, 81, 0.7),rgba(62, 69, 81, 0.3)); 
			 box-shadow: 10px 10px 5px #16222a;  border-radius: 2%;">

			<h1 style="color: white;text-shadow: 2px 2px 4px #000000;">LIMS Order Entry</h1>
				<p style="color: black;text-shadow: 2px 2px 4px #000000; font-weight:bold;">Facility Name <br/>
					<span class="color:white;" style="">Kawale Health Centre</span></p>

					<p style="color: black;text-shadow: 2px 2px 4px #000000;;font-weight:bold;">Ward/Location <br/>
					<span class="text-white" style=""><%= session[:ward] %></span>
				</p>

		</div>

		
		<div class="col-sm-7" style="margin-top: 1%;">
			<div style=" overflow: auto; height: 32%; padding-top: 1%;padding-left: 1%;padding-right: 1%;border: thin solid lightgrey;box-shadow: 10px 10px 5px #16222a; 
			    ">

				<div>	
						<div class="col-sm-8">
							
					
						</div>
						<div class="col-sm-4">
							<div class="panel panel-default" style="color: blue;box-shadow: 10px 10px 5px #182848;">
								<h4 style="text-align: center;font-weight: bold"> Scaning Undrawn Samples</h4>
							</div>
							
						</div>
				</div>
				<div   style="margin-top: 12.8%;">
					<div class="col-sm-4">
						<div class="panel panel-default" style="color: #1c2a48;box-shadow: 10px 10px 5px #182848;">
							<div  class="panel-heading" style="color: #1c2a48 ; font-weight:bold; text-align: center;">Orders with No Results</div>
							<div class="panel-body" style="font-size: 2em;font-weight:bold; text-align: center;">0 </div>
						</div>
					</div>

					<div class="col-sm-4">
						<div class="panel panel-default" style="color:lightgreen;box-shadow: 10px 10px 5px #182848;">
							<% requested_sample = session[:requested_sample] %>
							<% if requested_sample >0 %>
								<div  class="panel-heading" style="color: red ; font-weight:bold; text-align: center;">	 
								  Requested Orders</div>
								<div class="panel-body" style="color:red; font-size: 2em; font-weight:bold; text-align: center;">
								 <%= requested_sample %> </div>
							<% else %>
								<div  class="panel-heading" style="color: #1c2a48; font-weight:bold; text-align: center;"> 
								  Requested Orders</div>
								<div class="panel-body" style="font-size: 2em; font-weight:bold; text-align: center;">
								 <%= requested_sample %> 
								</div>
							<% end %>
						
						</div>
					</div>

					<div class="col-sm-4">
						<div class="panel panel-default" style="color: blue;box-shadow: 10px 10px 5px #182848;">
								<% undispatched_sample_count = session[:un_dis_sample] %>
								<% if undispatched_sample_count >0 %>
									<div  class="panel-heading" style="color:red; font-weight:bold; text-align: center;">Undispatched Samples</div>
									<div class="panel-body" style="font-size: 2em; color:red; font-weight:bold; text-align: center;">
										<%= undispatched_sample_count %></div>
								<% else %>
									<div  class="panel-heading" style="color:#1c2a48; font-weight:bold; text-align: center;">Undispatched Samples</div>
									<div class="panel-body" style="font-size: 2em; color:#1c2a48; font-weight:bold; text-align: center;">
									<%= undispatched_sample_count %></div>
								<% end %>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>



	<% if !params[:err].blank? %>
		<% error = params[:err] %>
	<% end %>




	<div class="row">
		<div style="border-top: thick solid grey; height: 55%;margin-left: 2%;margin-right: 2%; margin-top: 1%;
		overflow: auto; 
		">
			
			<div class="container">
				<label style="padding-top: 20px;">Scan Sample Barcode</label>
				<div  style="background-color:  #eeeeee; padding-left: 10%;">
					<span> <%= image_tag("extras/barcode-2.png") %> </span>
					<input class="input" type="text" name="scanned-barcode" id="barcode-txt" />
				</div>
			</div>

		</div>
	</div>

</div>
		


<div class="footer">
  <button class="btn-back btn btn-lg btn-success" onmousedown="document.location='/home'" ><| Back Home</button>
 	
 	<span style="float: right;">
			<button class="btn btns btn-lg btn-info" 
	     					id="log_out"
	     					onmousedown="draw_samples()">
	     				Finish
	    	</button>
	</span>

</div>

<script type="text/javascript">

	function get_samples()
	{	var samples;
		var _url = '/get_samples_to_be_drawn';
		jQuery.ajax({
					async: false,
					url: _url,
					success: function(res)
					{	
						samples = res;
					},	
					error: function(err)
					{
						alert(err.responseText);
					}
		});

		return samples;
	}

	function draw_samples()
	{
		document.location='/draw?samples=' + samples.toString();

	}


	function focusForBarcodeInput(){
	  var barcode = document.getElementById("barcode-txt");
	  if (barcode) 
	    barcode.focus();
	}
	    var samples = get_samples();
	    samples = samples.split("_");

	function barcodeScan(){
	  usertext=document.getElementById("barcode-txt");
	  if (usertext.value.match(/.+\$$/i) != null){	  	
	    usertext.value=usertext.value.substring(0,usertext.value.length -1);
	
	    var index = samples.indexOf(usertext.value);
	    samples.splice(index,1);	    
	    samples = samples
	  }
	}

	setInterval("focusForBarcodeInput();",300);
	setInterval("barcodeScan();",300);

</script>