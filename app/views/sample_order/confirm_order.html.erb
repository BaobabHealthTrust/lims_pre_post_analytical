
  <%= javascript_include_tag "jquery" %>
  <%= javascript_include_tag "bootstrap" %>
  <%= stylesheet_link_tag "bootstrap.min" %>
  <%= stylesheet_link_tag "extras/footer" %>
  <%= javascript_include_tag "sw.min" %>

<style type="text/css">
	
	.button:hover {background-color: #3e8e41}

	.button:active {
	  background-color: #3e8e41;
	  box-shadow: 0 5px #666;
	  transform: translateY(4px);	
</style>

<div style=" height: 97%; background: -moz-linear-gradient(right,#d3cce3,#e9e4f0 );" class="container-fluid"  >

	<div class="row">
		<div class="col-sm-4" style="height: 32%; margin-top: 1%; margin-left: 2%;
			 background: -moz-linear-gradient(right,rgba(62, 69, 81, 0.7),rgba(62, 69, 81, 0.3)); 
			 box-shadow: 10px 10px 5px #16222a;  border-radius: 2%;">


			<h1 style="color: white;text-shadow: 2px 2px 4px #000000;">LIMS Order Entry</h1>
				<p style="color: black;text-shadow: 2px 2px 4px #000000; font-weight:bold;">Facility Name <br/>
					<span class="color:white;" style="">Kawale Health Centre</span></p>

					<p style="color: black;text-shadow: 2px 2px 4px #000000;;font-weight:bold;">Ward/Location <br/>
					<span class="text-white" style=""><%= session[:ward] %></span>
				</p>

		</div>

		<div class="col-sm-7" style="margin-top: 1%;"">
			<div style=" overflow: auto; height: 32%; padding-top: 1%;padding-left: 1%;padding-right: 1%;border: thin solid lightgrey;box-shadow: 10px 10px 5px #16222a; 
			    ">
				<div >	
					<div class="col-sm-8">
						<div class="panel panel-default" style="color: orange;box-shadow: 10px 10px 5px #182848;">
							<% data = session[:patient_demo] %>
							<table class="table" style="font-size: 1em;">
								<tr>
									<td>Patient Id:</td>
									<td><%= data['npid']%></td>
								</tr>
								<tr>
									<td>Patient Name:</td>
									<td><%= data['name']%></td>
								</tr>
								<tr>
									<td>Gender</td>
									<td><%= data['gender']%></td>
								</tr>
							</table>
						</div>
				
				
					</div>
					<div class="col-sm-4">
						<div class="panel panel-default" style="color: blue;box-shadow: 10px 10px 5px #182848;">
							<h4 style="text-align: center;font-weight: bold;"> Order Confirmation </h4>
						</div>
						<div class="panel panel-default" style="color: blue;box-shadow: 10px 10px 5px #182848; padding: 1.5%;">
							<h4 style="text-align: center;">
								<% if !@order.blank? %>
									<%= @order['sample_type'] %> 
								<% end %>
							</h4>

						</div>
					</div>
				</div>
				<div style="margin-top: 12.8%;">
					<div class="col-sm-4">
						<div class="panel panel-default" style="color: #1c2a48 ;box-shadow: 10px 10px 5px #182848;">
							<div  class="panel-heading" style="color: #1c2a48 ; font-weight:bold; text-align: center;">Orders with No Results</div>
							<div class="panel-body" style="color: #1c2a48;font-size: 1em;font-weight:bold; text-align: center;">0 </div>
						</div>
					</div>

					<div class="col-sm-4">
						<div class="panel panel-default" style="color:lightgreen;box-shadow: 10px 10px 5px #182848;">
							<% requested_sample = session[:requested_sample] %>
							<% if requested_sample >0 %>
								<div  class="panel-heading" style="color: red ; font-weight:bold; text-align: center;">	 
								  Requested Orders</div>
								<div class="panel-body" style="color:red; font-size: 1em; font-weight:bold; text-align: center;">
								 <%= requested_sample %> </div>
							<% else %>
								<div  class="panel-heading" style="color: #1c2a48; font-weight:bold; text-align: center;"> 
								  Requested Orders</div>
								<div class="panel-body" style="font-size: 1em; font-weight:bold; text-align: center;">
								 <%= requested_sample %> 
								</div>
							<% end %>
						
						</div>
					</div>

					<div class="col-sm-4">
						<div class="panel panel-default" style="color: blue;box-shadow: 10px 10px 5px #182848;">
								<% undispatched_sample_count = session[:un_dis_sample] %>
								<% if undispatched_sample_count >0 %>
									<div  class="panel-heading" style="color:red; font-weight:bold; text-align: center;">Undispatched Samples</div>
									<div class="panel-body" style="font-size: 1em; color:red; font-weight:bold; text-align: center;">
										<%= undispatched_sample_count %></div>
								<% else %>
									<div  class="panel-heading" style="color:#1c2a48; font-weight:bold; text-align: center;">Undispatched Samples</div>
									<div class="panel-body" style="font-size: 1em; color:#1c2a48; font-weight:bold; text-align: center;">
									<%= undispatched_sample_count %></div>
								<% end %>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>








	<div class="row">
		<div style=" border-top: thick solid grey; height: 55%;margin-left: 2%;margin-right: 2%; margin-top: 1%;
		overflow: auto;">			
			<div class="col-sm-offset-2 col-sm-8 col-sm-offset-2" style="margin-top: 2%;">
					
				<table class="table table-striped">
					<thead>
						<tr style="background: -moz-linear-gradient(right,rgba(62, 69, 81, 0.7),rgba(62, 69, 81, 0.3));color: white; ">
							<th>Test Name</th>
							<th>Test Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<% counter = 0 %>
						
						<% if !@order['tests'].blank? %>
							<% location ="/add_test?rec_lab=" + @order['target_lab'] + "&sample=" + @order['sample_type'] %>
							<% @order['tests'].each do |test| %>
								<% counter = counter + 1 %>
								<% next if test.empty? %>
								<tr id="<%= counter %>" >
									<td><%= test %></td>
									<td> Drawn</td>
									<td><button class="btn btn-lg btn-danger"
										 id="<%= counter.to_s + '_' + test %>"
										 onmousedown="delete_test(this)">Delete</button></td>
								</tr>
							<% end %>
							<% counter = 0 %>
						<% end %>
					</tbody>
				</table>
			</div>

		</div>
	</div>

</div>



<div class="footer">
  <button class="btn-back btn btn-lg btn-primary" onmousedown="document.location='/home'">|< Back Home</button>
    <span style="float: right;">
	    <button class="btn btns btn-lg btn-danger"	id="log_out" onmousedown="document.location='/home'">
	     	Cancel
	   	</button>

	   	<button  class="btn btns btn-lg btn-primary" onmousedown="document.location='<%= location %>'">
			Add Test
	    </button>

		<button class="btn btns btn-lg btn-success" onmousedown="document.location='/submite_order'">
			Finish
		</button>
		<button class="btns btn btn-lg btn-danger" 
	     					id="log_out"
	     					onmousedown="document.location='/'">
	     				Log Out
	    	</button>
    </span>
</div>


<script type="text/javascript">
	
	function orderSample()
	{
		var _url = "/submite_order";

		jQuery.ajax({
					async: false,
					url: _url,
					success: function(res)
					{
					 	swal("Success","Sample Order Done Successfuly","success");
					},
					error: function(err)
					{
							console.log(err);
					}
		})
	}

	function delete_test(object)
	{  var id = object.id.split('_');		
		
	   	swal("Deletion","Are you sure you want to delete the test?", "warning",{
			  buttons: {
			    no: {
					  text: "No",
					  value: "no"
					},
			    yes: {
			      text: "Yes",
			      value: "yes",

			         }
			          },
			})
			.then((value) => {
			  switch (value) {
			 			 
			    case "yes":
				 	$(id[0]).remove();					 	
				 	remove_test_from_order(id[1]);
				 	document.location.reload(true);
			      break;
			 }
		});
	}

	function remove_test_from_order(test_name)
	{  
		var url_ = "/remove_test?test_name=" + test_name;		
		jQuery.ajax({
						async: false,
						url: url_,
						success: function(res)
						{
								
						},
						error: function(err)
						{
								console.log(err);
						}
		})
	}


</script>








